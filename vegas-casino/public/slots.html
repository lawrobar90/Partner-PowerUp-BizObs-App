<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Slots - Dynatrace Casino</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dt-purple': '#6C2C9C',
                        'dt-blue': '#00A1C9',
                        'dt-cyan': '#00D4FF',
                        'dt-green': '#73BE28',
                        'dt-orange': '#FFA86B',
                        'dt-yellow': '#FFD23F',
                        'dt-dark': '#151515',
                        'dt-darker': '#0A0A0A',
                        'dt-gray': '#2D2D2D',
                        'dt-light-gray': '#4A4A4A'
                    }
                }
            }
        }
    </script>
    
    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Quantum Slots Smartscape Theme */
        .slots-bg {
            background: 
                radial-gradient(circle at 20% 30%, rgba(108, 44, 156, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(115, 190, 40, 0.05) 0%, transparent 70%),
                linear-gradient(135deg, #0A0A0A 0%, #151515 100%);
        }
        
        .slot-machine-container {
            background: linear-gradient(145deg, rgba(21, 21, 21, 0.95), rgba(45, 45, 45, 0.8));
            border: 2px solid rgba(0, 212, 255, 0.3);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 30px rgba(0, 212, 255, 0.2);
            backdrop-filter: blur(20px);
        }
        
        .slot-reel {
            background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            border: 2px solid rgba(108, 44, 156, 0.6);
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(108, 44, 156, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .slot-reel::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(0, 212, 255, 0.3) 50%, 
                transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        
        .slot-reel:hover::before {
            opacity: 1;
        }
        
        .slot-symbol {
            font-size: 3rem;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.8);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
            transition: all 0.3s ease;
        }
        
        .spinning .slot-symbol {
            animation: reel-spin 0.1s linear infinite;
            filter: blur(2px);
        }
        
        @keyframes reel-spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }
        
        .winning-reel {
            border-color: #73BE28 !important;
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(115, 190, 40, 0.8) !important;
            animation: win-pulse 1s ease-in-out infinite alternate;
        }
        
        .winning-reel .slot-symbol {
            animation: win-celebrate 1s ease-in-out infinite alternate;
            text-shadow: 0 0 30px rgba(115, 190, 40, 1);
        }
        
        @keyframes win-pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        @keyframes win-celebrate {
            0% { transform: scale(1) rotate(-1deg); }
            100% { transform: scale(1.1) rotate(1deg); }
        }
        
        .lever-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .lever {
            width: 90px;
            height: 220px;
            background: linear-gradient(145deg, #4A4A4A, #2D2D2D);
            border: 3px solid rgba(0, 212, 255, 0.6);
            border-radius: 45px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.6),
                inset 0 2px 4px rgba(255, 255, 255, 0.1),
                0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        .lever:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 30px rgba(0, 0, 0, 0.8),
                inset 0 2px 4px rgba(255, 255, 255, 0.2),
                0 0 30px rgba(0, 212, 255, 0.5);
        }
        
        .lever:active {
            transform: translateY(10px);
            box-shadow: 
                0 4px 10px rgba(0, 0, 0, 0.6),
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(0, 212, 255, 0.4);
        }
        
        .lever-handle {
            width: 65px;
            height: 65px;
            background: linear-gradient(145deg, #FFD23F, #E6BD36);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 4px 10px rgba(0, 0, 0, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }
        
        .lever-pull-text {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(0, 212, 255, 0.9);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .pulling .lever {
            transform: translateY(15px) rotate(5deg);
        }
        
        .jackpot-alert {
            background: linear-gradient(135deg, 
                rgba(115, 190, 40, 0.9) 0%, 
                rgba(255, 210, 63, 0.9) 100%);
            border: 2px solid #73BE28;
            box-shadow: 
                0 0 40px rgba(115, 190, 40, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: jackpot-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes jackpot-glow {
            0% { 
                box-shadow: 0 0 40px rgba(115, 190, 40, 0.6);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 0 60px rgba(115, 190, 40, 0.8);
                transform: scale(1.02);
            }
        }
        
        .metrics-panel {
            background: rgba(21, 21, 21, 0.95);
            border: 1px solid rgba(0, 212, 255, 0.3);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }
        
        .metric-value {
            background: linear-gradient(45deg, #00D4FF, #6C2C9C, #73BE28);
            background-size: 300% 300%;
            animation: metric-shimmer 3s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes metric-shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 212, 255, 0.8) 50%, 
                transparent 100%);
            animation: line-pulse 2s ease-in-out infinite;
        }
        
        @keyframes line-pulse {
            0%, 100% { opacity: 0.3; transform: scaleX(0.8); }
            50% { opacity: 1; transform: scaleX(1.2); }
        }
        
        .control-button {
            background: linear-gradient(145deg, rgba(0, 161, 201, 0.8), rgba(108, 44, 156, 0.8));
            border: 1px solid rgba(0, 212, 255, 0.5);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .control-button:hover {
            background: linear-gradient(145deg, rgba(0, 161, 201, 1), rgba(108, 44, 156, 1));
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 0 20px rgba(0, 212, 255, 0.4);
            transform: translateY(-2px);
        }
        
        .control-button:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(0, 0, 0, 0.2);
        }
        
        .balance-display {
            background: linear-gradient(145deg, rgba(45, 45, 45, 0.9), rgba(21, 21, 21, 0.9));
            border: 2px solid rgba(255, 210, 63, 0.6);
            box-shadow: 
                0 0 20px rgba(255, 210, 63, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .spinning-indicator {
            animation: spin-indicator 1s linear infinite;
        }
        
        @keyframes spin-indicator {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Enhanced Symbol Rarity Effects */
        .rarity-legendary {
            animation: legendary-glow 2s ease-in-out infinite alternate;
            filter: drop-shadow(0 0 15px rgba(255, 210, 63, 0.8));
        }
        
        .rarity-epic {
            animation: epic-pulse 1.5s ease-in-out infinite alternate;
            filter: drop-shadow(0 0 10px rgba(108, 44, 156, 0.6));
        }
        
        .rarity-rare {
            filter: drop-shadow(0 0 8px rgba(0, 161, 201, 0.4));
        }
        
        .rarity-common {
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
        }
        
        @keyframes legendary-glow {
            0% { 
                transform: scale(1);
                filter: drop-shadow(0 0 15px rgba(255, 210, 63, 0.8)) hue-rotate(0deg);
            }
            100% { 
                transform: scale(1.05);
                filter: drop-shadow(0 0 25px rgba(255, 210, 63, 1)) hue-rotate(30deg);
            }
        }
        
        @keyframes epic-pulse {
            0% { 
                transform: scale(1);
                filter: drop-shadow(0 0 10px rgba(108, 44, 156, 0.6));
            }
            100% { 
                transform: scale(1.03);
                filter: drop-shadow(0 0 20px rgba(108, 44, 156, 0.9));
            }
        }
        
        /* Enhanced Win Effects */
        .mega-win {
            animation: mega-win-explosion 2s ease-in-out infinite;
            border: 3px solid #FFD23F !important;
            box-shadow: 
                0 0 40px rgba(255, 210, 63, 1),
                inset 0 0 40px rgba(255, 210, 63, 0.3) !important;
        }
        
        .special-win {
            animation: special-combination 1.5s ease-in-out infinite;
            border: 3px solid #6C2C9C !important;
            box-shadow: 
                0 0 30px rgba(108, 44, 156, 0.8),
                inset 0 0 30px rgba(108, 44, 156, 0.2) !important;
        }
        
        @keyframes mega-win-explosion {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                filter: hue-rotate(0deg);
            }
            25% { 
                transform: scale(1.1) rotate(1deg);
                filter: hue-rotate(90deg);
            }
            75% { 
                transform: scale(1.05) rotate(-1deg);
                filter: hue-rotate(270deg);
            }
        }
        
        @keyframes special-combination {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 30px rgba(108, 44, 156, 0.8);
            }
            50% { 
                transform: scale(1.08);
                box-shadow: 0 0 50px rgba(108, 44, 156, 1);
            }
        }
        
        /* Celebration Particles */
        @keyframes celebrate {
            0% {
                transform: translateY(0) rotate(0deg) scale(0);
                opacity: 1;
            }
            50% {
                transform: translateY(-50vh) rotate(180deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg) scale(0);
                opacity: 0;
            }
        }
        
        /* Enhanced Symbol Container */
        .symbol-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            transition: all 0.3s ease;
        }
        
        .symbol-icon {
            text-shadow: 0 0 20px currentColor;
            transition: all 0.3s ease;
        }
        
        .symbol-name {
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
    </style>
</head>
<body class="min-h-screen slots-bg text-white font-sans">
    
    <!-- Header -->
    <header class="bg-dt-dark/90 backdrop-blur-md border-b border-dt-cyan/20">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <button onclick="window.location.href='lobby.html'" class="control-button text-white px-4 py-2 rounded-lg font-semibold flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                    </svg>
                    <span>Back to Lobby</span>
                </button>
                
                <div class="text-center">
                    <div class="flex items-center justify-center space-x-3">
                        <img src="/assets/slot-icons/dynatrace.png" alt="Dynatrace Logo" class="h-8 w-8 filter drop-shadow-lg">
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-dt-cyan via-dt-purple to-dt-green bg-clip-text text-transparent">
                            Quantum Slots
                        </h1>
                        <img src="/assets/slot-icons/dynatrace.png" alt="Dynatrace Logo" class="h-8 w-8 filter drop-shadow-lg">
                    </div>
                    <p class="text-dt-light-gray text-sm mt-1">Smartscape-Powered Gaming Experience</p>
                </div>
                
                <div class="balance-display px-4 py-2 rounded-lg">
                    <div class="text-sm text-dt-light-gray">Balance</div>
                    <div class="text-xl font-bold text-dt-yellow">$<span id="balance">1000</span></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid lg:grid-cols-4 gap-8">
            
            <!-- Live Metrics Panel -->
            <div class="lg:col-span-1">
                <div class="metrics-panel rounded-xl p-6">
                    <div class="flex items-center space-x-2 mb-6">
                        <div class="w-3 h-3 bg-dt-green rounded-full animate-pulse"></div>
                        <h3 class="text-lg font-semibold text-dt-cyan">Live Metrics</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-sm">Total Spins</span>
                            <span class="metric-value text-lg font-bold" id="totalSpins">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-sm">Wins</span>
                            <span class="metric-value text-lg font-bold" id="totalWins">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-sm">Win Rate</span>
                            <span class="metric-value text-lg font-bold" id="winRate">0%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-sm">Biggest Win</span>
                            <span class="metric-value text-lg font-bold" id="biggestWin">$0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-sm">Session Profit</span>
                            <span class="metric-value text-lg font-bold" id="sessionProfit">$0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Payouts and Information Panel -->
                <div class="metrics-panel rounded-xl p-6 mt-6">
                    <div class="flex items-center space-x-2 mb-6">
                        <div class="w-3 h-3 bg-dt-yellow rounded-full animate-pulse"></div>
                        <h3 class="text-lg font-semibold text-dt-yellow">Payout Matrix</h3>
                    </div>
                    
                    <!-- Triple Payouts -->
                    <div class="mb-4">
                        <h5 class="text-sm font-semibold text-dt-cyan mb-2">üèÜ TRIPLE MATCHES</h5>
                        <div class="space-y-1 text-xs">
                            <div class="flex justify-between items-center text-dt-cyan">
                                <span>‚ö° ‚ö° ‚ö°</span><span class="font-bold">100x - QUANTUM JACKPOT!</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üåê üåê üåê</span><span>50x - Smartscape Mastery</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üì± üì± üì±</span><span>25x - App Excellence</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üóÑÔ∏è üóÑÔ∏è üóÑÔ∏è</span><span>20x - Data Champion</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üñ•Ô∏è üñ•Ô∏è üñ•Ô∏è</span><span>15x - Server Domination</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Double Payouts -->
                    <div class="mb-4">
                        <h5 class="text-sm font-semibold text-dt-orange mb-2">‚≠ê DOUBLE MATCHES</h5>
                        <div class="space-y-1 text-xs text-dt-light-gray">
                            <div class="flex justify-between items-center">
                                <span>‚ö° ‚ö° ‚ú¶</span><span>10x - Dynatrace Power</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üåê üåê ‚ú¶</span><span>5x - Smartscape Sync</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üì± üì± ‚ú¶</span><span>3x - App Boost</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üóÑÔ∏è üóÑÔ∏è ‚ú¶</span><span>2x - Data Duo</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Special Combinations -->
                    <div>
                        <h5 class="text-sm font-semibold text-dt-purple mb-2">üíé SPECIAL COMBOS</h5>
                        <div class="space-y-1 text-xs text-dt-light-gray">
                            <div class="flex justify-between items-center text-dt-green">
                                <span>‚ö° üåê üì±</span><span class="font-bold">75x - FULL STACK!</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üóÑÔ∏è üñ•Ô∏è ‚òÅÔ∏è</span><span>30x - Infrastructure Trinity</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>üõ°Ô∏è üîó ‚öôÔ∏è</span><span>20x - Security Stack</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slot Machine -->
            <div class="lg:col-span-2">
                <div class="slot-machine-container rounded-xl p-8 relative">
                    
                    <!-- Jackpot Banner (Hidden by default) -->
                    <div id="jackpotBanner" class="jackpot-alert rounded-lg p-4 mb-6 text-center hidden">
                        <div class="text-2xl font-bold text-white mb-2">üéä JACKPOT! üéä</div>
                        <div class="text-lg text-white" id="jackpotAmount">$0</div>
                        <div class="text-sm text-white/80">Quantum Entanglement Achieved!</div>
                    </div>
                    
                    <!-- Slot Reels -->
                    <div class="relative mb-8">
                        <div class="grid grid-cols-3 gap-6 mb-6">
                            <div class="slot-reel rounded-xl aspect-square flex items-center justify-center relative" id="reel1">
                                <div class="slot-symbol" id="symbol1">üçí</div>
                                <div class="connection-line w-12 -right-6 top-1/2 transform -translate-y-1/2"></div>
                            </div>
                            <div class="slot-reel rounded-xl aspect-square flex items-center justify-center relative" id="reel2">
                                <div class="slot-symbol" id="symbol2">üçí</div>
                                <div class="connection-line w-12 -right-6 top-1/2 transform -translate-y-1/2"></div>
                            </div>
                            <div class="slot-reel rounded-xl aspect-square flex items-center justify-center" id="reel3">
                                <div class="slot-symbol" id="symbol3">üçí</div>
                            </div>
                        </div>
                        
                        <!-- Payline Indicator -->
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div class="w-full h-1 bg-gradient-to-r from-transparent via-dt-yellow to-transparent opacity-50"></div>
                        </div>
                    </div>
                    
                    <!-- Game Controls -->
                    <div class="grid grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <label class="block text-dt-light-gray text-sm font-medium">Bet Amount</label>
                            <select id="betAmount" class="w-full bg-dt-gray border border-dt-cyan/30 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-dt-cyan">
                                <option value="10">$10</option>
                                <option value="25">$25</option>
                                <option value="50" selected>$50</option>
                                <option value="100">$100</option>
                                <option value="250">$250</option>
                            </select>
                        </div>
                        
                        <div class="space-y-4">
                            <label class="block text-dt-light-gray text-sm font-medium">Auto Spin</label>
                            <div class="flex space-x-2">
                                <button id="autoSpin5" class="control-button px-4 py-2 rounded-lg text-sm flex-1">5x</button>
                                <button id="autoSpin10" class="control-button px-4 py-2 rounded-lg text-sm flex-1">10x</button>
                                <button id="stopAuto" class="control-button px-4 py-2 rounded-lg text-sm flex-1 hidden">Stop</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Result Display -->
                    <div id="resultDisplay" class="text-center mt-6 min-h-[2rem]"></div>
                </div>
            </div>
            
            <!-- Lever and Test Controls -->
            <div class="lg:col-span-1 flex flex-col items-center space-y-6">
                
                <!-- Quantum Lever -->
                <div class="lever-container">
                    <div class="lever" id="quantumLever">
                        <div class="lever-handle">
                            <div class="w-full h-full rounded-full bg-gradient-to-br from-dt-yellow to-dt-orange relative overflow-hidden flex items-center justify-center">
                                <div class="absolute inset-0 bg-gradient-to-br from-white/30 to-transparent"></div>
                                <div class="relative z-10 text-white font-bold text-xl drop-shadow-lg">‚ö°</div>
                            </div>
                        </div>
                        <div class="lever-pull-text">
                            PULL
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <div class="text-sm text-dt-light-gray font-medium">Quantum Lever</div>
                        <div class="text-xs text-dt-cyan font-semibold" id="leverStatus">Ready</div>
                    </div>
                </div>
                
                <!-- Test Controls -->
                <div class="w-full space-y-4">
                    <button id="testPayouts" class="w-full control-button px-4 py-3 rounded-lg font-semibold text-sm">
                        üß™ Test Payouts
                    </button>
                    <button id="maxBet" class="w-full control-button px-4 py-3 rounded-lg font-semibold text-sm">
                        üíé Max Bet
                    </button>
                </div>
                
                <!-- Spinning Indicator -->
                <div id="spinningIndicator" class="hidden">
                    <div class="spinning-indicator w-12 h-12 border-4 border-dt-cyan/30 border-t-dt-cyan rounded-full"></div>
                    <div class="text-center mt-2 text-sm text-dt-cyan">Spinning...</div>
                </div>
            </div>
        </div>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Initialize game state
    const socket = io();
    // Persisted username across the app
    let currentUser = localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || '';
    let balance = 1000;
        let isSpinning = false;
    let autoSpinCount = 0;
    let autoSpinActive = false;
    // Hold server-authoritative balance until spin visuals complete
    let pendingServerNewBalance = null;
        let sessionStats = {
            totalSpins: 0,
            totalWins: 0,
            biggestWin: 0,
            sessionProfit: 0
        };

        // Enhanced Dynatrace Slot Symbols with visual styling
        const symbols = {
            // Premium Dynatrace Symbols (Highest Payouts)
            'dynatrace': { icon: '‚ö°', name: 'Dynatrace Core', color: '#00D4FF', rarity: 'legendary' },
            'smartscape': { icon: 'ÔøΩ', name: 'Smartscape', color: '#6C2C9C', rarity: 'epic' },
            'application': { icon: 'üì±', name: 'Application', color: '#73BE28', rarity: 'epic' },
            'database': { icon: 'üóÑÔ∏è', name: 'Database', color: '#FFD23F', rarity: 'epic' },
            
            // Technology Symbols (High Payouts)
            'server': { icon: 'üñ•Ô∏è', name: 'Server', color: '#00A1C9', rarity: 'rare' },
            'cloud': { icon: '‚òÅÔ∏è', name: 'Cloud', color: '#FFA86B', rarity: 'rare' },
            'shield': { icon: 'ÔøΩÔ∏è', name: 'Security', color: '#FF6B6B', rarity: 'rare' },
            'chart': { icon: 'üìä', name: 'Analytics', color: '#4ECDC4', rarity: 'rare' },
            'network': { icon: 'ÔøΩ', name: 'Network', color: '#45B7D1', rarity: 'rare' },
            
            // Service Symbols (Medium Payouts)
            'services': { icon: '‚öôÔ∏è', name: 'Services', color: '#96CEB4', rarity: 'common' },
            'host': { icon: 'üè†', name: 'Host', color: '#FFEAA7', rarity: 'common' },
            'process': { icon: 'üîÑ', name: 'Process', color: '#DDA0DD', rarity: 'common' },
            'memory': { icon: 'ÔøΩ', name: 'Memory', color: '#98D8C8', rarity: 'common' },
            'cpu': { icon: 'üß†', name: 'CPU', color: '#F7DC6F', rarity: 'common' }
        };
        
        // Comprehensive Payout Matrix
        const payoutMatrix = {
            // Triple Matches (All 3 same)
            triple: {
                'dynatrace': { multiplier: 100, name: 'QUANTUM JACKPOT!' },
                'smartscape': { multiplier: 50, name: 'SMARTSCAPE MASTERY!' },
                'application': { multiplier: 25, name: 'APP EXCELLENCE!' },
                'database': { multiplier: 20, name: 'DATA CHAMPION!' },
                'server': { multiplier: 15, name: 'SERVER DOMINATION!' },
                'cloud': { multiplier: 12, name: 'CLOUD CONQUEST!' },
                'shield': { multiplier: 10, name: 'SECURITY MASTER!' },
                'chart': { multiplier: 8, name: 'ANALYTICS ACE!' },
                'network': { multiplier: 6, name: 'NETWORK NINJA!' },
                'services': { multiplier: 4, name: 'SERVICE STAR!' },
                'host': { multiplier: 3, name: 'HOST HERO!' },
                'process': { multiplier: 2, name: 'PROCESS PRO!' },
                'memory': { multiplier: 2, name: 'MEMORY MAVEN!' },
                'cpu': { multiplier: 2, name: 'CPU CHAMPION!' }
            },
            // Double Matches (2 same)
            double: {
                'dynatrace': { multiplier: 10, name: 'Dynatrace Power!' },
                'smartscape': { multiplier: 5, name: 'Smartscape Sync!' },
                'application': { multiplier: 3, name: 'App Boost!' },
                'database': { multiplier: 2, name: 'Data Duo!' },
                'server': { multiplier: 2, name: 'Server Pair!' },
                'cloud': { multiplier: 1.5, name: 'Cloud Combo!' },
                'shield': { multiplier: 1.5, name: 'Shield Sync!' },
                'chart': { multiplier: 1.2, name: 'Chart Pair!' },
                'network': { multiplier: 1.2, name: 'Network Link!' },
                'services': { multiplier: 1, name: 'Service Match!' },
                'host': { multiplier: 1, name: 'Host Pair!' },
                'process': { multiplier: 0.5, name: 'Process Match!' },
                'memory': { multiplier: 0.5, name: 'Memory Sync!' },
                'cpu': { multiplier: 0.5, name: 'CPU Pair!' }
            },
            // Special Combinations
            special: {
                'dynatrace_smartscape_application': { multiplier: 75, name: 'FULL STACK MASTERY!' },
                'database_server_cloud': { multiplier: 30, name: 'INFRASTRUCTURE TRINITY!' },
                'shield_network_services': { multiplier: 20, name: 'SECURITY STACK!' },
                'chart_memory_cpu': { multiplier: 15, name: 'PERFORMANCE TRIO!' }
            }
        };
        
        // Make symbols available globally
        window.symbols = symbols;
        window.payoutMatrix = payoutMatrix;

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize user from previous login stored by index.html
            if (!currentUser) {
                currentUser = 'Anonymous_' + Math.random().toString(36).slice(2,7);
                localStorage.setItem('vegas.username', currentUser);
            }
            // Sync balance from server
            try {
                const resp = await fetch(`/api/user/init`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ Username: currentUser }) });
                const data = await resp.json();
                if (data && typeof data.balance === 'number') {
                    balance = data.balance;
                    localStorage.setItem('vegasBalance', String(balance));
                }
            } catch {}
            initializeSlotDisplay();
            updateDisplay();
            initializeEventListeners();
            
            // Entrance animations
            gsap.from('.slot-machine-container', {
                duration: 1,
                y: 50,
                opacity: 0,
                ease: "power3.out"
            });
            
            gsap.from('.metrics-panel', {
                duration: 1,
                x: -50,
                opacity: 0,
                ease: "power3.out",
                delay: 0.2
            });
            
            gsap.from('.lever-container', {
                duration: 1,
                x: 50,
                opacity: 0,
                ease: "power3.out",
                delay: 0.4
            });
        });
        
        function initializeSlotDisplay() {
            // Initialize slot reels with default symbols
            const defaultSymbols = ['services', 'host', 'process'];
            defaultSymbols.forEach((symbolKey, index) => {
                const symbolElement = document.getElementById(`symbol${index + 1}`);
                const symbolData = window.symbols[symbolKey];
                
                if (symbolElement && symbolData) {
                    symbolElement.innerHTML = `
                        <div class="symbol-container" style="color: ${symbolData.color}">
                            <div class="symbol-icon text-4xl mb-1">${symbolData.icon}</div>
                            <div class="symbol-name text-xs font-semibold opacity-75">${symbolData.name}</div>
                        </div>
                    `;
                    symbolElement.className = `slot-symbol rarity-${symbolData.rarity}`;
                }
            });
        }

        function initializeEventListeners() {
            // Quantum lever
            document.getElementById('quantumLever').addEventListener('click', pullLever);
            
            // Auto spin buttons
            document.getElementById('autoSpin5').addEventListener('click', () => startAutoSpin(5));
            document.getElementById('autoSpin10').addEventListener('click', () => startAutoSpin(10));
            document.getElementById('stopAuto').addEventListener('click', stopAutoSpin);
            
            // Test controls
            document.getElementById('testPayouts').addEventListener('click', testPayouts);
            document.getElementById('maxBet').addEventListener('click', () => {
                document.getElementById('betAmount').value = '250';
                showNotification('Max bet selected: $250', 'info');
            });
        }

        function pullLever() {
            if (isSpinning || autoSpinActive) return;
            
            const lever = document.getElementById('quantumLever');
            const leverStatus = document.getElementById('leverStatus');
            
            // Lever animation
            lever.classList.add('pulling');
            leverStatus.textContent = 'Pulling...';
            
            setTimeout(() => {
                lever.classList.remove('pulling');
                leverStatus.textContent = 'Ready';
                spin();
            }, 300);
        }

        function spin() {
            if (isSpinning) return;
            
            const betAmount = parseInt(document.getElementById('betAmount').value);
            if (betAmount > balance) {
                showNotification('Insufficient balance!', 'error');
                return;
            }
            
            isSpinning = true;
            
            // Immediately deduct bet amount from balance (show stake placed)
            balance -= betAmount;
            updateDisplay();
            
            showSpinningIndicator(true);
            
            // Animate reels
            animateReels();
            
            // Build required BizEvents payload with app variables
            const corrId = `sim_${Date.now()}_${Math.floor(Math.random()*1e9)}`;
            const nowIso = new Date().toISOString();
            const bizEventPayload = {
                Game: 'Vegas Slots Machine',
                BetAmount: betAmount,
                Username: currentUser || 'Anonymous',
                // Win/loss unknown until server response; send placeholders first
                WinFlag: null,
                WinningAmount: 0,
                LossAmount: 0,
                Balance: balance,
                Timestamp: nowIso,
                Action: 'Spin',
                Device: 'Browser-UI',
                CorrelationId: corrId,
                ResultIcons: [],
                Status: 'Started',
                ErrorType: null,
                ErrorMessage: null,
                StatusCode: 0
            };
            
            // Send HTTP POST request to /api/slots/spin for OneAgent capture
            fetch('/api/slots/spin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(bizEventPayload)
            })
            .then(response => response.json())
            .then(data => {
                // Handle the response as if it came from socket
                handleSlotsResult(data);
                // Defer balance application until reels stop
                if (typeof data.newBalance === 'number') {
                    pendingServerNewBalance = data.newBalance;
                }
            })
            .catch(error => {
                console.error('Slots spin error:', error);
                showNotification('Spin error occurred', 'error');
                // Refund stake on error
                balance += betAmount;
                updateDisplay();
                isSpinning = false;
                showSpinningIndicator(false);
            });
        }

        function animateReels() {
            const reels = document.querySelectorAll('.slot-reel');
            const symbolElements = document.querySelectorAll('.slot-symbol');
            
            // Add spinning class
            reels.forEach(reel => reel.classList.add('spinning'));
            
            // Animate symbols
            symbolElements.forEach((symbolElement, index) => {
                const symbolKeys = Object.keys(window.symbols);
                let spinCount = 0;
                const maxSpins = 20 + (index * 8);
                
                const spinInterval = setInterval(() => {
                    const randomSymbolKey = symbolKeys[Math.floor(Math.random() * symbolKeys.length)];
                    const symbolData = window.symbols[randomSymbolKey];
                    
                    // Update symbol with enhanced styling
                    symbolElement.innerHTML = `
                        <div class="symbol-container" style="color: ${symbolData.color}">
                            <div class="symbol-icon text-4xl mb-1">${symbolData.icon}</div>
                            <div class="symbol-name text-xs font-semibold opacity-75">${symbolData.name}</div>
                        </div>
                    `;
                    
                    // Add rarity glow effect
                    symbolElement.className = `slot-symbol rarity-${symbolData.rarity}`;
                    
                    spinCount++;
                    
                    if (spinCount >= maxSpins) {
                        clearInterval(spinInterval);
                        if (index === symbolElements.length - 1) {
                            // Last reel finished - remove spinning class and show result
                            setTimeout(() => {
                                reels.forEach(reel => reel.classList.remove('spinning'));
                                // Display the result after reels stop spinning
                                displaySpinResult();
                            }, 200);
                        }
                    }
                }, 100);
            });
        }

        function showSpinningIndicator(show) {
            const indicator = document.getElementById('spinningIndicator');
            const leverStatus = document.getElementById('leverStatus');
            
            if (show) {
                indicator.classList.remove('hidden');
                leverStatus.textContent = 'Spinning...';
            } else {
                indicator.classList.add('hidden');
                leverStatus.textContent = 'Ready';
            }
        }

        function startAutoSpin(count) {
            if (isSpinning) return;
            
            autoSpinCount = count;
            autoSpinActive = true;
            
            document.getElementById('autoSpin5').classList.add('hidden');
            document.getElementById('autoSpin10').classList.add('hidden');
            document.getElementById('stopAuto').classList.remove('hidden');
            
            autoSpinNext();
        }

        function autoSpinNext() {
            if (!autoSpinActive || autoSpinCount <= 0) {
                stopAutoSpin();
                return;
            }
            
            if (!isSpinning) {
                spin();
                autoSpinCount--;
            }
            
            setTimeout(autoSpinNext, 3000);
        }

        function stopAutoSpin() {
            autoSpinActive = false;
            autoSpinCount = 0;
            
            document.getElementById('autoSpin5').classList.remove('hidden');
            document.getElementById('autoSpin10').classList.remove('hidden');
            document.getElementById('stopAuto').classList.add('hidden');
        }

        function testPayouts() {
            const testCombinations = [
                { symbols: ['dynatrace', 'dynatrace', 'dynatrace'], name: 'Quantum Jackpot' },
                { symbols: ['diamond', 'diamond', 'diamond'], name: 'Diamond Triple' },
                { symbols: ['seven', 'seven', 'seven'], name: 'Lucky Seven' },
                { symbols: ['cherry', 'cherry', 'cherry'], name: 'Cherry Triple' }
            ];
            
            let testIndex = 0;
            
            function runNextTest() {
                if (testIndex >= testCombinations.length) {
                    showNotification('All payout tests completed!', 'success');
                    return;
                }
                
                const test = testCombinations[testIndex];
                
                // Set symbols on reels
                test.symbols.forEach((symbolKey, index) => {
                    const symbolElement = document.getElementById(`symbol${index + 1}`);
                    symbolElement.textContent = symbols[symbolKey] || symbolKey;
                });
                
                // Test payout calculation
                fetch('/api/slots/test-payout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        symbols: test.symbols,
                        betAmount: 50
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.win) {
                        showWinResult(data.winAmount, data.multiplier, test.name);
                    } else {
                        showNotification(`${test.name}: No win`, 'info');
                    }
                    
                    testIndex++;
                    setTimeout(runNextTest, 2000);
                })
                .catch(error => {
                    console.error('Test error:', error);
                    testIndex++;
                    setTimeout(runNextTest, 1000);
                });
            }
            
            runNextTest();
        }

        function showWinResult(amount, multiplier, winType = '', description = '') {
            const reels = document.querySelectorAll('.slot-reel');
            
            // Add winning animation with rarity-based effects
            reels.forEach(reel => {
                reel.classList.add('winning-reel');
                if (amount >= 1000) reel.classList.add('mega-win');
                if (winType === 'special') reel.classList.add('special-win');
            });
            
            // Show jackpot banner for big wins
            if (amount >= 1000) {
                const banner = document.getElementById('jackpotBanner');
                const amountEl = document.getElementById('jackpotAmount');
                
                banner.classList.remove('hidden');
                amountEl.innerHTML = `
                    <div class="text-3xl font-bold text-white mb-2">üéä ${description || 'MEGA WIN!'} üéä</div>
                    <div class="text-2xl text-white">$${amount.toLocaleString()}</div>
                    <div class="text-lg text-white/80">${multiplier}x Multiplier</div>
                `;
                
                // Add celebration particles
                createCelebrationEffect();
                
                setTimeout(() => {
                    banner.classList.add('hidden');
                }, 6000);
            }
            
            // Show result message with enhanced styling
            let message, messageType;
            if (amount >= 1000) {
                message = `üéä ${description} $${amount.toLocaleString()} (${multiplier}x)`;
                messageType = 'mega-success';
            } else if (amount >= 100) {
                message = `ÔøΩ ${description || 'BIG WIN!'} $${amount} (${multiplier}x)`;
                messageType = 'big-success';
            } else {
                message = `‚ú® ${description || 'WIN!'} $${amount} (${multiplier}x)`;
                messageType = 'success';
            }
            
            showNotification(message, messageType);
            
            // Remove winning animation after delay
            setTimeout(() => {
                reels.forEach(reel => {
                    reel.classList.remove('winning-reel', 'mega-win', 'special-win');
                });
            }, 4000);
        }
        
        function createCelebrationEffect() {
            // Create floating celebration particles
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'celebration-particle';
                particle.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: linear-gradient(45deg, #FFD23F, #73BE28, #00D4FF);
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1000;
                    left: ${Math.random() * 100}vw;
                    top: ${Math.random() * 100}vh;
                    animation: celebrate 3s ease-out forwards;
                `;
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 3000);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg border backdrop-blur-md ${
                type === 'success' ? 'bg-dt-green/90 border-dt-green text-white' :
                type === 'error' ? 'bg-red-500/90 border-red-500 text-white' :
                'bg-dt-blue/90 border-dt-blue text-white'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            gsap.from(notification, {
                duration: 0.3,
                x: 100,
                opacity: 0,
                ease: "power2.out"
            });
            
            setTimeout(() => {
                gsap.to(notification, {
                    duration: 0.3,
                    x: 100,
                    opacity: 0,
                    ease: "power2.in",
                    onComplete: () => notification.remove()
                });
            }, 4000);
        }

        function updateDisplay() {
            document.getElementById('balance').textContent = balance;
            document.getElementById('totalSpins').textContent = sessionStats.totalSpins;
            document.getElementById('totalWins').textContent = sessionStats.totalWins;
            document.getElementById('winRate').textContent = sessionStats.totalSpins > 0 ? 
                `${((sessionStats.totalWins / sessionStats.totalSpins) * 100).toFixed(1)}%` : '0%';
            document.getElementById('biggestWin').textContent = `$${sessionStats.biggestWin}`;
            document.getElementById('sessionProfit').textContent = `$${sessionStats.sessionProfit}`;
        }

        // Handle slots result from HTTP API
        function handleSlotsResult(data) {
            // Store the result for delayed display
            pendingResult = data;
            
            // Defer session metric updates until reels finish spinning
            const winAmount = data.winAmount || data.winnings || 0;
            const betAmount = data.betAmount || parseInt(document.getElementById('betAmount').value);
            pendingSessionDelta = {
                betAmount,
                winAmount
            };
            // Do not update UI metrics yet; they'll refresh on spin completion
        }

    // Socket event handlers (keeping for compatibility)
    let pendingResult = null;
    let pendingSessionDelta = null; // defer metrics until spin completes
        
        socket.on('slots-result', (data) => {
            // Use the same handler function for socket results
            handleSlotsResult(data);
        });
        
        function displaySpinResult() {
            if (!pendingResult) return;
            
            const { symbols: resultSymbols, multiplier, winAmount, winnings } = pendingResult;
            const actualWinAmount = winAmount || winnings || 0;
            
            // Display final symbols with enhanced styling
            if (resultSymbols) {
                resultSymbols.forEach((symbolKey, index) => {
                    const symbolElement = document.getElementById(`symbol${index + 1}`);
                    const symbolData = window.symbols[symbolKey] || { icon: '‚ùì', name: 'Unknown', color: '#666', rarity: 'common' };
                    
                    // Create enhanced symbol display
                    symbolElement.innerHTML = `
                        <div class="symbol-container" style="color: ${symbolData.color}">
                            <div class="symbol-icon text-4xl mb-1">${symbolData.icon}</div>
                            <div class="symbol-name text-xs font-semibold opacity-75">${symbolData.name}</div>
                        </div>
                    `;
                    
                    // Add rarity styling
                    symbolElement.className = `slot-symbol rarity-${symbolData.rarity}`;
                });
            }
            
            // Calculate detailed payout information
            const payoutInfo = calculateDetailedPayout(resultSymbols, parseInt(document.getElementById('betAmount').value));

            // Show result after a brief pause for suspense
            setTimeout(() => {
                // Apply final balance when reels finish
                if (pendingServerNewBalance !== null) {
                    balance = pendingServerNewBalance;
                    pendingServerNewBalance = null;
                } else if (actualWinAmount > 0) {
                    // If no server value, apply winnings locally
                    balance += actualWinAmount;
                }
                
                // Now that the spin visuals have completed, apply deferred session metrics
                const appliedBetAmount = pendingSessionDelta?.betAmount ?? parseInt(document.getElementById('betAmount').value);
                sessionStats.totalSpins++;
                if (actualWinAmount > 0) {
                    sessionStats.totalWins++;
                    if (actualWinAmount > sessionStats.biggestWin) {
                        sessionStats.biggestWin = actualWinAmount;
                    }
                }
                sessionStats.sessionProfit += (actualWinAmount - appliedBetAmount);
                updateDisplay();
                // Persist new balance
                localStorage.setItem('vegasBalance', String(balance));
                // Show outcome messaging
                if (actualWinAmount > 0) {
                    showWinResult(actualWinAmount, multiplier, payoutInfo.winType, payoutInfo.description);
                } else {
                    showNotification('üé∞ Better luck next time! Keep spinning for big wins!', 'info');
                }

                // Emit Completed BizEvent with resolved outcome fields
                try {
                    const completedEvent = {
                        Game: 'Vegas Slots Machine',
                        BetAmount: parseInt(document.getElementById('betAmount').value),
                        Username: currentUser || 'Anonymous',
                        WinFlag: actualWinAmount > 0 ? 1 : 0,
                        WinningAmount: actualWinAmount,
                        LossAmount: actualWinAmount > 0 ? 0 : parseInt(document.getElementById('betAmount').value),
                        Balance: balance,
                        Timestamp: new Date().toISOString(),
                        Action: 'SpinCompleted',
                        Device: 'Browser-UI',
                        CorrelationId: pendingResult?.correlationId || `sim_${Date.now()}`,
                        ResultIcons: Array.isArray(resultSymbols) ? resultSymbols : [],
                        Status: 'Completed',
                        ErrorType: null,
                        ErrorMessage: null,
                        StatusCode: 200
                    };
                    fetch('/api/bizevent', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(completedEvent) });
                } catch {}
                
                isSpinning = false;
                showSpinningIndicator(false);
                pendingResult = null;
                pendingSessionDelta = null;
                // reset state for next spin
            }, 500); // Half second pause for dramatic effect
        }
        
        // Enhanced payout calculation
        function calculateDetailedPayout(symbols, betAmount) {
            if (!symbols || symbols.length !== 3) return { winAmount: 0, multiplier: 0, winType: '', description: '' };
            
            const symbolCounts = {};
            symbols.forEach(symbol => {
                symbolCounts[symbol] = (symbolCounts[symbol] || 0) + 1;
            });
            
            // Check for special combinations first
            const sortedSymbols = symbols.slice().sort().join('_');
            for (const [combo, payout] of Object.entries(window.payoutMatrix.special)) {
                if (sortedSymbols === combo) {
                    return {
                        winAmount: betAmount * payout.multiplier,
                        multiplier: payout.multiplier,
                        winType: 'special',
                        description: payout.name
                    };
                }
            }
            
            // Check for triple matches
            for (const [symbol, count] of Object.entries(symbolCounts)) {
                if (count === 3) {
                    const payout = window.payoutMatrix.triple[symbol];
                    if (payout) {
                        return {
                            winAmount: betAmount * payout.multiplier,
                            multiplier: payout.multiplier,
                            winType: 'triple',
                            description: payout.name
                        };
                    }
                }
            }
            
            // Check for double matches
            for (const [symbol, count] of Object.entries(symbolCounts)) {
                if (count === 2) {
                    const payout = window.payoutMatrix.double[symbol];
                    if (payout) {
                        return {
                            winAmount: betAmount * payout.multiplier,
                            multiplier: payout.multiplier,
                            winType: 'double',
                            description: payout.name
                        };
                    }
                }
            }
            
            return { winAmount: 0, multiplier: 0, winType: '', description: '' };
        }

        socket.on('slots-error', (data) => {
            showNotification(data.message || 'Spin error occurred', 'error');
            isSpinning = false;
            showSpinningIndicator(false);
        });
    </script>
</body>
</html>