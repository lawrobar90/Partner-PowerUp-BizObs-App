<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynatrace Vegas - Leaderboard Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dt-purple': '#6C2C9C',
                        'dt-blue': '#00A1C9',
                        'dt-cyan': '#00D4FF',
                        'dt-green': '#73BE28',
                        'dt-orange': '#FFA86B',
                        'dt-yellow': '#FFD23F',
                        'dt-dark': '#151515',
                        'dt-darker': '#0A0A0A',
                        'dt-gray': '#2D2D2D',
                        'dt-light-gray': '#4A4A4A'
                    }
                }
            }
        }
    </script>
    
    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Dashboard specific styles */
        .dashboard-bg {
            background: 
                radial-gradient(circle at 15% 25%, rgba(108, 44, 156, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 85% 75%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0A0A0A 0%, #151515 100%);
        }
        
        .dashboard-card {
            background: rgba(21, 21, 21, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 212, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            border-color: rgba(0, 212, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.1);
        }
        
        .metric-card {
            background: linear-gradient(145deg, rgba(45, 45, 45, 0.8), rgba(21, 21, 21, 0.9));
            border: 1px solid rgba(0, 212, 255, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00D4FF, transparent);
            animation: scan-line 3s ease-in-out infinite;
        }
        
        @keyframes scan-line {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .leaderboard-row {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .leaderboard-row:hover {
            background: rgba(0, 212, 255, 0.05);
            border-left-color: #00D4FF;
            transform: translateX(4px);
        }
        
        .rank-badge {
            background: linear-gradient(145deg, #6C2C9C, #4A1B6B);
            border: 2px solid #00D4FF;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
            animation: rank-glow 2s ease-in-out infinite alternate;
        }
        
        .rank-badge.gold {
            background: linear-gradient(145deg, #FFD23F, #E6BD36);
            border-color: #FFD23F;
            box-shadow: 0 0 20px rgba(255, 210, 63, 0.6);
        }
        
        .rank-badge.silver {
            background: linear-gradient(145deg, #C0C0C0, #A8A8A8);
            border-color: #C0C0C0;
            box-shadow: 0 0 15px rgba(192, 192, 192, 0.4);
        }
        
        .rank-badge.bronze {
            background: linear-gradient(145deg, #CD7F32, #B5652A);
            border-color: #CD7F32;
            box-shadow: 0 0 15px rgba(205, 127, 50, 0.4);
        }
        
        @keyframes rank-glow {
            0% { box-shadow: 0 0 15px rgba(0, 212, 255, 0.4); }
            100% { box-shadow: 0 0 25px rgba(0, 212, 255, 0.6); }
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .stat-number {
            background: linear-gradient(45deg, #00D4FF, #6C2C9C, #00D4FF);
            background-size: 200% 200%;
            animation: stat-shimmer 3s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes stat-shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .activity-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: activity-pulse 2s ease-in-out infinite;
        }
        
        .activity-indicator.online {
            background: #73BE28;
            box-shadow: 0 0 8px rgba(115, 190, 40, 0.6);
        }
        
        .activity-indicator.offline {
            background: #666;
            box-shadow: none;
            animation: none;
        }
        
        @keyframes activity-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        .performance-bar {
            height: 6px;
            background: rgba(45, 45, 45, 0.8);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .performance-fill {
            height: 100%;
            background: linear-gradient(90deg, #73BE28, #00D4FF);
            border-radius: 3px;
            transition: width 1s ease-out;
        }
    </style>
</head>
<body class="min-h-screen dashboard-bg text-white font-sans">
    
    <!-- Header -->
    <header class="bg-dt-dark/90 backdrop-blur-md border-b border-dt-cyan/20">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="window.location.href='lobby.html'" class="bg-dt-purple hover:bg-dt-purple/80 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                        </svg>
                        <span>Back to Lobby</span>
                    </button>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-dt-cyan via-dt-purple to-dt-green bg-clip-text text-transparent">üèÜ Casino Champions</h1>
                        <p class="text-sm text-dt-light-gray">Live leaderboard ‚Ä¢ Expo attendees competing for glory!</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="activity-indicator online"></div>
                        <span class="text-sm text-dt-green font-mono">Live Data</span>
                    </div>
                    <div class="text-sm text-dt-light-gray">
                        Last updated: <span id="lastUpdated" class="font-mono">--:--</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Dashboard -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Key Metrics Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Total Players -->
            <div class="metric-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-dt-blue to-dt-cyan rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold stat-number" id="totalPlayers">1,247</div>
                        <div class="text-xs text-dt-light-gray">Total Agents</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-fill" style="width: 85%"></div>
                </div>
                <div class="text-xs text-dt-green mt-2">+12% this week</div>
            </div>
            
            <!-- Active Players -->
            <div class="metric-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-dt-green to-dt-yellow rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold stat-number" id="activePlayers">89</div>
                        <div class="text-xs text-dt-light-gray">Currently Online</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-fill" style="width: 65%"></div>
                </div>
                <div class="text-xs text-dt-green mt-2">Peak: 156</div>
            </div>
            
            <!-- Total Revenue -->
            <div class="metric-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-dt-purple to-dt-blue rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold stat-number" id="totalRevenue">$247K</div>
                        <div class="text-xs text-dt-light-gray">Total Revenue</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-fill" style="width: 92%"></div>
                </div>
                <div class="text-xs text-dt-green mt-2">+8.3% today</div>
            </div>
            
            <!-- Win Rate -->
            <div class="metric-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-dt-orange to-dt-yellow rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold stat-number" id="globalWinRate">23.7%</div>
                        <div class="text-xs text-dt-light-gray">Global Win Rate</div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="performance-fill" style="width: 24%"></div>
                </div>
                <div class="text-xs text-dt-light-gray mt-2">Expected: 25%</div>
            </div>
        </div>
        
        <div class="grid lg:grid-cols-3 gap-8">
            
            <!-- Leaderboard Table -->
            <div class="lg:col-span-2">
                <div class="dashboard-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-dt-cyan flex items-center space-x-2">
                            <span>üéÆ Top Players</span>
                            <span class="text-sm bg-dt-purple/20 text-dt-purple px-2 py-1 rounded-full">Live</span>
                        </h2>
                        <div class="flex items-center space-x-2">
                            <button id="refreshBtn" onclick="refreshLeaderboard()" class="bg-dt-blue hover:bg-dt-blue/80 text-white px-3 py-1 rounded text-sm font-semibold transition-colors">
                                Refresh
                            </button>
                            <select id="sortBy" onchange="sortLeaderboard()" class="bg-dt-gray border border-dt-cyan/30 rounded px-3 py-1 text-sm text-white focus:outline-none focus:border-dt-cyan">
                                <option value="totalWins">Total Wins</option>
                                <option value="totalWagered">Total Wagered</option>
                                <option value="winRate">Win Rate</option>
                                <option value="streak">Current Streak</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="space-y-3" id="leaderboardList">
                        <!-- Leaderboard entries will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Charts and Analytics -->
            <div class="space-y-6">
                
                <!-- Activity Chart -->
                <div class="dashboard-card rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-dt-cyan mb-4">Activity Overview</h3>
                    <div class="chart-container">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
                
                <!-- Game Distribution -->
                <div class="dashboard-card rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-dt-cyan mb-4">Popular Games</h3>
                    <div class="space-y-4" id="gameDistribution">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-dt-purple rounded-full animate-pulse"></div>
                                <span class="text-sm">Quantum Slots</span>
                            </div>
                            <span class="text-sm font-mono text-dt-yellow" id="slotsPercent">42%</span>
                        </div>
                        <div class="performance-bar">
                            <div class="performance-fill transition-all duration-1000" id="slotsBar" style="width: 42%; background: linear-gradient(90deg, #6C2C9C, #8A44B8);"></div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-dt-green rounded-full animate-pulse"></div>
                                <span class="text-sm">Cosmic Roulette</span>
                            </div>
                            <span class="text-sm font-mono text-dt-yellow" id="roulettePercent">28%</span>
                        </div>
                        <div class="performance-bar">
                            <div class="performance-fill transition-all duration-1000" id="rouletteBar" style="width: 28%; background: linear-gradient(90deg, #73BE28, #8FD633);"></div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-dt-blue rounded-full animate-pulse"></div>
                                <span class="text-sm">Quantum Blackjack</span>
                            </div>
                            <span class="text-sm font-mono text-dt-yellow" id="blackjackPercent">20%</span>
                        </div>
                        <div class="performance-bar">
                            <div class="performance-fill transition-all duration-1000" id="blackjackBar" style="width: 20%; background: linear-gradient(90deg, #00A1C9, #00D4FF);"></div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-dt-orange rounded-full animate-pulse"></div>
                                <span class="text-sm">Neural Dice</span>
                            </div>
                            <span class="text-sm font-mono text-dt-yellow" id="dicePercent">10%</span>
                        </div>
                        <div class="performance-bar">
                            <div class="performance-fill transition-all duration-1000" id="diceBar" style="width: 10%; background: linear-gradient(90deg, #FFA86B, #FFB885);"></div>
                        </div>
                    </div>
                </div>
                
                <!-- System Health -->
                <div class="dashboard-card rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-dt-cyan mb-4">System Health</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-dt-light-gray">Server Load</span>
                            <div class="flex items-center space-x-2">
                                <div class="performance-bar w-20">
                                    <div class="performance-fill" id="serverLoadBar" style="width: 35%; background: #73BE28;"></div>
                                </div>
                                <span class="text-sm font-mono text-dt-green" id="serverLoadText">35%</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-dt-light-gray">Memory Usage</span>
                            <div class="flex items-center space-x-2">
                                <div class="performance-bar w-20">
                                    <div class="performance-fill" id="memoryBar" style="width: 62%; background: #FFD23F;"></div>
                                </div>
                                <span class="text-sm font-mono text-dt-yellow" id="memoryText">62%</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-dt-light-gray">Response Time</span>
                            <div class="flex items-center space-x-2">
                                <div class="activity-indicator online"></div>
                                <span class="text-sm font-mono text-dt-green" id="responseTimeText">23ms</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-dt-light-gray">Uptime</span>
                            <span class="text-sm font-mono text-dt-green" id="uptimeText">99.97%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Initialize Socket.IO
        const socket = io();
        
        // Sample leaderboard data - will be replaced with API data
        let leaderboardData = [];
        let activityChart;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadLeaderboardData();
            initializeActivityChart();
            
            // Animate page entrance
            gsap.from('.metric-card', {
                duration: 0.8,
                y: 50,
                opacity: 0,
                stagger: 0.1,
                ease: "power3.out"
            });
            
            gsap.from('.dashboard-card', {
                duration: 1,
                y: 30,
                opacity: 0,
                stagger: 0.15,
                ease: "power3.out",
                delay: 0.3
            });
        });
        
        // Load leaderboard and metrics data from API
        async function loadLeaderboardData() {
            try {
                // Load both leaderboard and metrics data
                const [leaderboardResponse, metricsResponse] = await Promise.all([
                    fetch('/api/leaderboard').catch(() => null),
                    fetch('/api/metrics')
                ]);
                
                if (leaderboardResponse && leaderboardResponse.ok) {
                    const data = await leaderboardResponse.json();
                    leaderboardData = data.leaderboard || generateFallbackData();
                } else {
                    leaderboardData = generateFallbackData();
                }
                
                if (metricsResponse && metricsResponse.ok) {
                    const metricsData = await metricsResponse.json();
                    updateDashboardMetrics(metricsData);
                }
                
                renderLeaderboard();
                updateLastUpdated();
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                leaderboardData = generateFallbackData();
                renderLeaderboard();
            }
        }
        
        function updateDashboardMetrics(data) {
            // Update key metrics
            document.getElementById('totalPlayers').textContent = (data.totalSpins + 1200).toLocaleString();
            document.getElementById('activePlayers').textContent = data.activeUsers || Math.floor(Math.random() * 50 + 50);
            document.getElementById('totalRevenue').textContent = `$${Math.floor(data.totalRevenue / 1000)}K`;
            document.getElementById('globalWinRate').textContent = `${((data.totalWins / (data.totalSpins || 1)) * 100).toFixed(1)}%`;
            
            // Update game distribution percentages
            if (data.gamesPlayed) {
                updateGameDistribution(data.gamesPlayed);
            }
            
            // Update system health
            if (data.systemHealth) {
                updateSystemHealth(data.systemHealth);
            }
            
            // Update activity chart with real data
            if (activityChart && data.gamesPlayed) {
                updateActivityChart(data.gamesPlayed);
            }
        }
        
        function updateGameDistribution(gamesData) {
            const total = Object.values(gamesData).reduce((sum, count) => sum + count, 0) || 1;
            
            // Calculate percentages
            const slotsPercent = Math.round((gamesData.slots / total) * 100);
            const roulettePercent = Math.round((gamesData.roulette / total) * 100);
            const blackjackPercent = Math.round((gamesData.blackjack / total) * 100);
            const dicePercent = Math.round((gamesData.dice / total) * 100);
            
            // Update percentage text
            document.getElementById('slotsPercent').textContent = `${slotsPercent}%`;
            document.getElementById('roulettePercent').textContent = `${roulettePercent}%`;
            document.getElementById('blackjackPercent').textContent = `${blackjackPercent}%`;
            document.getElementById('dicePercent').textContent = `${dicePercent}%`;
            
            // Update progress bars with animation
            document.getElementById('slotsBar').style.width = `${slotsPercent}%`;
            document.getElementById('rouletteBar').style.width = `${roulettePercent}%`;
            document.getElementById('blackjackBar').style.width = `${blackjackPercent}%`;
            document.getElementById('diceBar').style.width = `${dicePercent}%`;
        }
        
        function generateFallbackData() {
            // Generate realistic expo attendee names with achievements
            const firstNames = ['Alex', 'Sarah', 'Mike', 'Emma', 'Chris', 'Jessica', 'David', 'Lisa', 'Ryan', 'Ashley', 'Kevin', 'Amanda', 'Josh', 'Nicole', 'Tyler', 'Rachel', 'Brandon', 'Stephanie', 'Justin', 'Michelle'];
            const companies = ['TechCorp', 'DevOps Inc', 'CloudSys', 'DataFlow', 'MonitorPro', 'ScaleTech', 'SecureNet', 'FastAPI', 'NextGen', 'SmartOps'];
            
            return firstNames.slice(0, 15).map((name, index) => {
                const company = companies[Math.floor(Math.random() * companies.length)];
                const totalWins = Math.floor(Math.random() * 800 + 200) - (index * 30);
                const totalWagered = totalWins * (Math.random() * 8 + 4);
                const winRate = Math.max(0.15, Math.min(0.85, (totalWins / (totalWins + Math.random() * 500))));
                
                return {
                    username: `${name}_${company}`,
                    displayName: name,
                    company: company,
                    totalWins: Math.max(50, totalWins),
                    totalWagered: Math.floor(totalWagered),
                    winRate: winRate,
                    achievements: generateAchievements(totalWins, winRate),
                    lastSeen: getRandomTimeAgo(),
                    favoriteGame: ['Quantum Slots', 'Blackjack', 'Roulette', 'Dice'][Math.floor(Math.random() * 4)],
                    streak: Math.floor(Math.random() * 10 + 1)
                };
            }).sort((a, b) => b.totalWins - a.totalWins);
        }
        
        function generateAchievements(wins, winRate) {
            const achievements = [];
            if (wins > 500) achievements.push('üèÜ High Roller');
            if (winRate > 0.7) achievements.push('üéØ Sharp Shooter');
            if (wins > 300) achievements.push('üíé VIP Player');
            if (winRate > 0.8) achievements.push('üî• On Fire');
            if (Math.random() > 0.7) achievements.push('‚ö° Speed Demon');
            return achievements.slice(0, 2);
        }
        
        function getRandomTimeAgo() {
            const options = ['Just now', '2 min ago', '5 min ago', '10 min ago', '15 min ago', 'Online now'];
            return options[Math.floor(Math.random() * options.length)];
        }
        
        function updateSystemHealth(health) {
            // Update server load
            const serverLoadBar = document.getElementById('serverLoadBar');
            const serverLoadText = document.getElementById('serverLoadText');
            if (serverLoadBar && serverLoadText) {
                serverLoadBar.style.width = `${health.cpu}%`;
                serverLoadBar.style.background = health.cpu > 80 ? '#FF6B6B' : health.cpu > 60 ? '#FFD23F' : '#73BE28';
                serverLoadText.textContent = `${health.cpu}%`;
                serverLoadText.className = health.cpu > 80 ? 'text-sm font-mono text-red-400' : 
                                           health.cpu > 60 ? 'text-sm font-mono text-dt-yellow' : 'text-sm font-mono text-dt-green';
            }
            
            // Update memory usage
            const memoryBar = document.getElementById('memoryBar');
            const memoryText = document.getElementById('memoryText');
            if (memoryBar && memoryText) {
                memoryBar.style.width = `${health.memory}%`;
                memoryBar.style.background = health.memory > 80 ? '#FF6B6B' : health.memory > 60 ? '#FFD23F' : '#73BE28';
                memoryText.textContent = `${health.memory}%`;
                memoryText.className = health.memory > 80 ? 'text-sm font-mono text-red-400' : 
                                       health.memory > 60 ? 'text-sm font-mono text-dt-yellow' : 'text-sm font-mono text-dt-green';
            }
            
            // Update response time
            const responseTimeText = document.getElementById('responseTimeText');
            if (responseTimeText) {
                responseTimeText.textContent = `${health.latency}ms`;
                responseTimeText.className = health.latency > 100 ? 'text-sm font-mono text-red-400' : 
                                            health.latency > 50 ? 'text-sm font-mono text-dt-yellow' : 'text-sm font-mono text-dt-green';
            }
            
            // Update uptime
            const uptimeText = document.getElementById('uptimeText');
            if (uptimeText) {
                const uptimeHours = (health.uptime / 3600).toFixed(1);
                uptimeText.textContent = `${uptimeHours}h`;
            }
        }
        }
        
        function renderLeaderboard() {
            const container = document.getElementById('leaderboardList');
            container.innerHTML = '';
            
            leaderboardData.forEach((player, index) => {
                const rank = index + 1;
                const isCurrentUser = player.username === localStorage.getItem('vegasUser');
                
                const row = document.createElement('div');
                row.className = `leaderboard-row p-4 rounded-lg border border-dt-gray/30 ${isCurrentUser ? 'bg-dt-purple/10 border-dt-purple/50' : ''}`;
                
                row.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="rank-badge ${getRankBadgeClass(rank)} w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg">
                                ${rank <= 3 ? ['ü•á', 'ü•à', 'ü•â'][rank-1] : rank}
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-dt-blue to-dt-cyan rounded-full flex items-center justify-center border-2 border-dt-cyan/30">
                                    <span class="text-sm font-bold text-white">${(player.displayName || player.username).charAt(0)}</span>
                                </div>
                                <div>
                                    <div class="font-semibold text-white ${isCurrentUser ? 'text-dt-cyan' : ''}">
                                        ${player.displayName || player.username}
                                        ${isCurrentUser ? ' <span class="text-dt-purple text-xs">(You!)</span>' : ''}
                                    </div>
                                    <div class="text-xs text-dt-light-gray flex items-center space-x-2">
                                        <span>${player.company || 'Expo Attendee'}</span>
                                        <span class="text-dt-green">‚Ä¢</span>
                                        <span>${player.lastSeen || 'Active'}</span>
                                    </div>
                                    <div class="text-xs mt-1 flex items-center space-x-1">
                                        ${(player.achievements || []).map(achievement => `<span class="bg-dt-purple/20 text-dt-purple px-2 py-0.5 rounded text-xs">${achievement}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-4 text-right">
                            <div>
                                <div class="text-lg font-bold text-dt-green">${player.totalWins.toLocaleString()}</div>
                                <div class="text-xs text-dt-light-gray">Wins</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-dt-yellow">$${(player.totalWagered).toLocaleString()}</div>
                                <div class="text-xs text-dt-light-gray">Wagered</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-dt-cyan">${(player.winRate * 100).toFixed(1)}%</div>
                                <div class="text-xs text-dt-light-gray">Win Rate</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-dt-orange">${player.streak || 0}</div>
                                <div class="text-xs text-dt-light-gray">Streak</div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(row);
                
                // Animate row entrance
                gsap.from(row, {
                    duration: 0.6,
                    x: -50,
                    opacity: 0,
                    delay: index * 0.05,
                    ease: "power2.out"
                });
            });
        }
        
        function getRankBadgeClass(rank) {
            if (rank === 1) return 'gold';
            if (rank === 2) return 'silver';
            if (rank === 3) return 'bronze';
            return '';
        }
        
        function sortLeaderboard() {
            const sortBy = document.getElementById('sortBy').value;
            
            leaderboardData.sort((a, b) => {
                switch (sortBy) {
                    case 'totalWins':
                        return b.totalWins - a.totalWins;
                    case 'totalWagered':
                        return b.totalWagered - a.totalWagered;
                    case 'winRate':
                        return b.winRate - a.winRate;
                    case 'streak':
                        return (b.streak || 0) - (a.streak || 0);
                    default:
                        return b.totalWins - a.totalWins;
                }
            });
            
            renderLeaderboard();
        }
        
        function refreshLeaderboard() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.textContent = 'Refreshing...';
            
            // Add refreshing animation
            const spinner = document.createElement('div');
            spinner.className = 'inline-block w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2';
            btn.insertBefore(spinner, btn.firstChild);
            
            setTimeout(() => {
                loadLeaderboardData();
                btn.disabled = false;
                btn.textContent = 'Refresh';
                spinner.remove();
                
                // Show success notification
                showNotification('Leaderboard updated!', 'success');
            }, 2000);
        }
        
        function initializeActivityChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            const data = {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [{
                    label: 'Active Players',
                    data: [23, 15, 45, 89, 156, 134],
                    borderColor: '#00D4FF',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            };
            
            activityChart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#4A4A4A'
                            },
                            grid: {
                                color: 'rgba(74, 74, 74, 0.3)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#4A4A4A'
                            },
                            grid: {
                                color: 'rgba(74, 74, 74, 0.3)'
                            }
                        }
                    }
                }
            });
            
            // Animate chart
            setTimeout(() => {
                activityChart.update();
            }, 1000);
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg border ${
                type === 'success' ? 'bg-dt-green/90 border-dt-green text-white' :
                type === 'error' ? 'bg-red-500/90 border-red-500 text-white' :
                'bg-dt-blue/90 border-dt-blue text-white'
            } backdrop-blur-md`;
            
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            gsap.from(notification, {
                duration: 0.3,
                x: 100,
                opacity: 0,
                ease: "power2.out"
            });
            
            // Remove after 3 seconds
            setTimeout(() => {
                gsap.to(notification, {
                    duration: 0.3,
                    x: 100,
                    opacity: 0,
                    ease: "power2.in",
                    onComplete: () => notification.remove()
                });
            }, 3000);
        }
        
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdated').textContent = timeString;
        }
        
        function updateDashboardMetrics(data) {
            // Update key metrics
            document.getElementById('totalPlayers').textContent = (data.totalSpins + 1200).toLocaleString();
            document.getElementById('activePlayers').textContent = data.activeUsers || Math.floor(Math.random() * 50 + 50);
            document.getElementById('totalRevenue').textContent = `$${Math.floor(data.totalRevenue / 1000)}K`;
            document.getElementById('globalWinRate').textContent = `${((data.totalWins / (data.totalSpins || 1)) * 100).toFixed(1)}%`;
            
            // Update system health
            if (data.systemHealth) {
                updateSystemHealth(data.systemHealth);
            }
            
            // Update activity chart with real data
            if (activityChart && data.gamesPlayed) {
                updateActivityChart(data.gamesPlayed);
            }
        }
        
        function updateSystemHealth(health) {
            // Update server load
            const serverLoadBar = document.querySelector('.performance-bar:nth-child(3) .performance-fill');
            if (serverLoadBar) {
                serverLoadBar.style.width = `${health.cpu}%`;
                serverLoadBar.style.background = health.cpu > 80 ? '#FF6B6B' : health.cpu > 60 ? '#FFD23F' : '#73BE28';
            }
            
            // Update memory usage
            const memoryBar = document.querySelector('.performance-bar:nth-child(6) .performance-fill');
            if (memoryBar) {
                memoryBar.style.width = `${health.memory}%`;
                memoryBar.style.background = health.memory > 80 ? '#FF6B6B' : health.memory > 60 ? '#FFD23F' : '#73BE28';
            }
            
            // Update response time
            const responseTimeElement = document.querySelector('.text-dt-green:last-child');
            if (responseTimeElement) {
                responseTimeElement.textContent = `${health.latency}ms`;
            }
        }
        
        function updateActivityChart(gamesData) {
            if (!activityChart) return;
            
            // Generate realistic activity data based on games played
            const total = Object.values(gamesData).reduce((sum, count) => sum + count, 0);
            const activityData = [
                Math.floor(total * 0.1),
                Math.floor(total * 0.05),
                Math.floor(total * 0.3),
                total,
                Math.floor(total * 1.5),
                Math.floor(total * 1.2)
            ];
            
            activityChart.data.datasets[0].data = activityData;
            activityChart.update('none');
        }
        
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdated').textContent = timeString;
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-6 right-6 z-50 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-dt-green text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-dt-blue text-white'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            gsap.from(notification, {
                duration: 0.3,
                x: 100,
                opacity: 0,
                ease: "back.out(1.7)"
            });
            
            // Auto remove
            setTimeout(() => {
                gsap.to(notification, {
                    duration: 0.3,
                    x: 100,
                    opacity: 0,
                    ease: "back.in(1.7)",
                    onComplete: () => notification.remove()
                });
            }, 3000);
        }
        
        // Socket event handlers
        socket.on('connect', () => {
            console.log('üîå Connected to leaderboard dashboard');
        });
        
        socket.on('metrics-update', (metrics) => {
            // Update real-time metrics
            document.getElementById('activePlayers').textContent = metrics.activeUsers || 0;
            
            // Update charts if needed
            if (activityChart && Math.random() < 0.1) { // 10% chance to update chart
                const newData = activityChart.data.datasets[0].data;
                newData.push(metrics.activeUsers || 0);
                if (newData.length > 6) {
                    newData.shift();
                }
                activityChart.update();
            }
        });
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (Math.random() < 0.3) { // 30% chance to refresh
                loadLeaderboardData();
            }
        }, 30000);
    </script>
</body>
</html>